function buyCountDown(){remainingTime?(minutos=Math.floor(remainingTime/60),_remainingTime=remainingTime-60*minutos,segundos=Math.floor(_remainingTime),remainingTime--,$("#buyResume .time .value").html(("00"+minutos).substr(-2,2)+":"+("00"+segundos).substr(-2,2)),remainingTime>=0&&setTimeout("buyCountDown()",1e3)):0===remainingTime&&(window.location=urlExp)}function setCCTypeIcon(a){type=detectCardType(a.replace(/\s/,"")),type&&($(".ccType").removeClass("VISA").removeClass("MASTERCARD").addClass(type),$("#BuyCctype").val(type))}function seatSelection(){$container=$(".seatsSelection"),$(".status-0",$container).on("click",seatClick)}function seatClick(){ticketsSelected.length<=countTickets&&countTickets&&!$(this).hasClass("status-selected")?($(".seatCheck",$(this)).attr("checked",!0),$(this).removeClass("status-0"),$(this).addClass("status-selected"),ticketsSelected.push({row:$(this).data("row"),column:$(this).data("column"),row_physical:$(this).data("row_physical"),column_physical:$(this).data("column_physical"),area_category:$(this).data("area_category"),area_number:$(this).data("area_number")}),ticketsSelected.length>countTickets&&(place_Class=".place-"+ticketsSelected[0].row+"-"+ticketsSelected[0].column+"-"+ticketsSelected[0].area_category+"-"+ticketsSelected[0].area_number,$(place_Class).removeClass("status-selected"),$(place_Class).addClass("status-0"),$(".seatCheck",$(place_Class)).attr("checked",!1),ticketsSelected.splice(0,1)),$("#buyResume .btnSelectSeats").css({display:"none"}),buildTicketsSeats(),updateResume(),updateSeatsInputs()):0==countTickets&&($(".message .content",$container).html("<p>"+__("no-tickets-selected-yet")+"</p><a href='#tickets' class='btn'>"+__("select-tickets")+"</a>"),$(".message",$container).show("fast"))}function updateSeatsInputs(){var a=$("#seatsInputs").empty(),b=0;$.each(Tickets,function(c,d){$.each(d.seats,function(c,d){$seat=$("<div></div>",{"class":"seat"}),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][row]",type:"hidden",value:d.row,"class":"row"})),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][column]",type:"hidden",value:d.column,"class":"column"})),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][row_physical]",type:"hidden",value:d.row_physical,"class":"row_physical"})),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][column_physical]",type:"hidden",value:d.column_physical,"class":"column_physical"})),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][area_category]",type:"hidden",value:d.area_category,"class":"area_category"})),$seat.append($("<input/>",{name:"data[BuySeat]["+b+"][area_number]",type:"hidden",value:d.area_number,"class":"area_number"})),a.append($seat),b++})})}function getTotalSeatsSeleted(){var a=0;return $.each(Tickets,function(b,c){a+=c.seats.length}),a}function buildTicketsArray(){var a=0;$(".ticketsSelection tr").each(function(){if(code=$(this).data("code"),code&&(cantidad=$(".cantidad",$(this)).data("qty"),Tickets[code]={qty:cantidad,seats:[]},cantidad>0&&BuySeat))for(i=0;i<cantidad;i++)Tickets[code].seats.push(BuySeat[a]),a++})}function buildTicketsSelectedArray(){ticketsSelected=[],$.each(Tickets,function(a,b){$.each(b.seats,function(a,b){ticketsSelected.push(b)})})}function updateResume(){$("#buyResume .tickets-details .ticket").removeClass("showing").css({display:"none"}),$.each(Tickets,function(a,b){b.qty>0&&($ticket=$("#buyResume .tickets-details tr[data-code='"+a+"']"),$ticket.addClass("showing").css({display:"table-row"}),$(".qty",$ticket).html(b.qty),seats="",$seats=$(".seats",$ticket),$.each(b.seats,function(a,b){seats+=b.row_physical+b.column_physical+" "}),$seats.html(seats))}),countTickets>0?($("#buyResume .btnSelectTicket").css({display:"none"}),$("#buyResume .btnSelectSeats").css({display:"inline-block"})):($("#buyResume .btnSelectTicket").css({display:"inline-block"}),$("#buyResume .btnSelectSeats").css({display:"none"})),getTotalSeatsSeleted()>0?$("#buyResume .btnSelectSeats").css({display:"none"}):countTickets>0&&$("#buyResume .btnSelectSeats").css({display:"inline-block"})}function updateSeatGrid(){$("#SeatLayout .status-selected").removeClass("status-selected").addClass("status-0"),$.each(Tickets,function(a,b){$.each(b.seats,function(a,b){place_Class=".place-"+b.row+"-"+b.column+"-"+b.area_category+"-"+b.area_number,console.log(place_Class),$place=$(place_Class),$place.removeClass("status-0").addClass("status-selected"),$place.hasClass("status-1")&&$place.removeClass("status-1").on("click",seatClick)})})}function buildTicketsSeats(){$.each(Tickets,function(a){Tickets[a].seats=[]}),$.each(ticketsSelected,function(a,b){done=!1,$.each(Tickets,function(a,c){c.qty>c.seats.length&&!done&&(Tickets[a].seats.push({row_physical:b.row_physical,row:b.row,column_physical:b.column_physical,column:b.column,area_category:b.area_category,area_number:b.area_number}),done=!0)})})}function setSeatsSelected(){BuySeat&&($.each(BuySeat,function(a,b){place_Class=".place-"+b.row+"-"+b.column+"-"+b.area_category+"-"+b.area_number,$place=$(place_Class),$place.removeClass("status-0").addClass("status-selected"),$place.hasClass("status-1")&&$place.removeClass("status-1").on("click",seatClick),ticketsSelected.push(b)}),buildTicketsSeats(),updateSeatsInputs())}function detectCardType(a){var b={electron:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/,maestro:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,dankort:/^(5019)\d+$/,interpayment:/^(636)\d+$/,unionpay:/^(62|88)\d+$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/,mastercard:/^5[1-5][0-9]{14}$/,amex:/^3[47][0-9]{13}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/};return b.electron.test(a)?"ELECTRON":b.maestro.test(a)?"MAESTRO":b.dankort.test(a)?"DANKORT":b.interpayment.test(a)?"INTERPAYMENT":b.unionpay.test(a)?"UNIONPAY":b.visa.test(a)?"VISA":b.mastercard.test(a)?"MASTERCARD":b.amex.test(a)?"AMEX":b.diners.test(a)?"DINERS":b.discover.test(a)?"DISCOVER":b.jcb.test(a)?"JCB":void 0}var countTickets=totalPayment=0,countTicketsLimit=10,ticketsSelected=[],LayoutZoom=1,LayoutLeft=0,LayoutTop=0,zoom=1,$container;$(document).on("ready",function(){function updateTotals(){totalPayment=0,$(".ticketsSelection tr").each(function(){$parent=$(this),code=$parent.data("code"),$cantidad=$(".cantidad",$parent),cantidad=$cantidad.data("qty"),precio=$("td.price",$parent).data("price"),subtotal=precio*cantidad,$(".subtotal",$parent).html("$"+subtotal.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")),$ticketResume=$("#buyResume .tickets-details tr[data-code='"+code+"']"),$(".subtotal",$ticketResume).html("$"+subtotal.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")),totalPayment+=subtotal,$(".ticketsSelection .total .value").html("$"+totalPayment.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")),$("#buyResume .total .value").html("$"+totalPayment.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,"))})}$("#BuyForm").on("submit",function(){$("#SendingBuy").css({display:"block"}),$("#BuyFormSubmit").prop("disabled",!0)}),$("#BuyCcnumber,#BuyCvv").on("keypress",function(a){key=a.keyCode||a.which,tecla=String.fromCharCode(key).toLowerCase(),numeros="1234567890",especiales=[8,37,39,46,9],tecla_especial=!1;for(var b in especiales)if(key==especiales[b]){tecla_especial=!0;break}return-1!=numeros.indexOf(tecla)||tecla_especial?void 0:!1}),$("#BuyCcname").on("keypress",function(a){key=a.keyCode||a.which,tecla=String.fromCharCode(key).toLowerCase(),letras=" abcdefghijklmnÃ±opqrstuvwxyz",especiales=[8,37,39,46,9],tecla_especial=!1;for(var b in especiales)if(key==especiales[b]){tecla_especial=!0;break}return-1!=letras.indexOf(tecla)||tecla_especial?void 0:!1}),$.ajax({url:"/shows/seatlayout/"+$("#SeatLayout").data("show"),success:function(html,status,http){return eval("var Xnotifier = "+http.getResponseHeader("X-Notifier")+";"),Xnotifier&&(Xnotifier.type="error")?void(window.location=urlError):($("#SeatLayout").html(html),$("#SeatLayout .layout").each(function(){new RTP.PinchZoom($(this),{})}),seatSelection(),void setSeatsSelected())}}),$(".ticketsSelection .plus").on("click",function(){$parent=$(this).closest("tr"),$cantidad=$(".cantidad",$parent),$qtyInput=$("input[rel='qty']",$parent),cantidad=$cantidad.data("qty"),precio=$("td.price",$parent).data("price"),code=$parent.data("code"),$(".message",$container).hide("fast"),countTicketsLimit>countTickets&&(cantidad++,countTickets++,$cantidad.data("qty",cantidad),$cantidad.html(cantidad),$qtyInput.attr("value",cantidad),Tickets[code].qty=cantidad,updateTotals(),updateResume())}),$(".ticketsSelection .less").on("click",function(){$parent=$(this).closest("tr"),$cantidad=$(".cantidad",$parent),$qtyInput=$("input[rel='qty']",$parent),cantidad=$cantidad.data("qty"),code=$parent.data("code"),precio=$("td.price",$parent).data("price"),0!=cantidad&&(cantidad--,countTickets--,$cantidad.data("qty",cantidad),$cantidad.html(cantidad),$qtyInput.attr("value",cantidad),Tickets[code].qty=cantidad,Tickets[code].seats.splice(Tickets[code].seats.length-1,1),buildTicketsSelectedArray(),updateSeatsInputs(),updateSeatGrid(),updateTotals(),updateResume())}),$("input[rel='qty']").each(function(){$parent=$(this).closest("tr"),$cantidad=$(".cantidad",$parent),countTickets+=1*$(this).attr("value"),$cantidad.data("qty",$(this).attr("value")).html($(this).attr("value")),$cantidad.data("qty")}),updateTotals(),$(document).on("click",".closeMessage",function(){$(this).closest(".message").hide("fast")}),setCCTypeIcon($("#BuyCcnumber").val()),$(document).on("change","#BuyCcnumber",function(){setCCTypeIcon($(this).val())});var $BuyResume=$("#buyResume");$("#main-header").append($BuyResume),$BuyResume.hasClass("remainingTime")?$BuyResume.addClass("sticky"):$(".ticketsSelection").waypoint({handler:function(a){"down"==a?$BuyResume.addClass("sticky"):$BuyResume.removeClass("sticky")},offset:400}),buyCountDown(),buildTicketsArray(),updateResume()});var minutos=0,segundos=0,Tickets={};