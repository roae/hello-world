var _xUpdaterDialogTmpl=["div",{"class":"modal hide fade",abindex:"-1",role:"dialog","aria-lebelledby":"myModalLabel","aria-hidden":!0},["div",{"class":"modal-header"},["button",{type:"button","class":"close","data-dismiss":"modal","aria-hidden":!0},"&times;","h3",{},""],"div",{"class":"modal-body"},"","div",{"class":"modal-footer"}]];$.xUpdater=function(a){var b=$.xUpdater;b.settings=$.extend({},b.settings,a||{}),b.selector=b.settings.selector,$.History.bind(function(a){a!=b.lastHash&&(b.loadPage(a),b.lastHash=a)}),$(b.selector).click(b.click),$.xUpdater.afterRequest.push(b.settings.callbacks.afterRequest),b.window=$.create(_xUpdaterDialogTmpl),$(".modal-header",b.window).remove(),b.window.attr("id","xUpdaterWindow").appendTo("body")},$.xUpdater.div="",$.xUpdater.selector="",$.xUpdater.id="",$.xUpdater.window=null,$.xUpdater.afterRequest=[],$.xUpdater.beforeRequest=[],$.xUpdater.lastHash="",$.xUpdater.loadPage=function(a){var b,c,d=$.xUpdater,e=($(this),a.match(/(.+)\=(.+)/));e&&(b=e[1].split("|"),c="#"+b.join(",#")),$(c).length?($(d.settings.indicator).fadeIn("slow"),d.execBeforeRequest(c),$.ajax({url:e[2],success:function(a){$.xUpdater.updateDivs(a),$(d.settings.indicator).fadeOut("slow")},beforeSend:function(a){a.setRequestHeader("X-update",b.join(" "))}}),d.div=c):!a&&d.div&&($(d.settings.indicator).fadeIn("slow"),d.execBeforeRequest(d.div),$.ajax({url:window.location.pathname,success:function(a){$.xUpdater.updateDivs(a),$(d.settings.indicator).fadeOut("slow")},beforeSend:function(a){a.setRequestHeader("X-update",d.div.replace(/#/g,"").replace(/,/g," "))}}))},$.xUpdater.click=function(){var a=$.xUpdater;if(id=$(this).attr("rev").match(/#(.+)/),id){var b=$(this);if(b.hasClass("noHistory"))$(a.settings.indicator).css({display:"block"}),a.execAction(b);else if(b.hasClass("action")&&void 0!==b.attr("rel")){var c=function(){return $(".modal-body",a.window).empty().createAppend(["div",{"class":"loading"},["i",{"class":"icon-sun icon-spin"},"","p",{"class":"msgLoading"},__("loading",!1)]]),$(".modal-footer",a.window).empty().hide(),a.execAction(b),!1};$(".modal-body",a.window).empty().createAppend(["i",{"class":"icon-question icon-3x icon"},[],"p",{"class":"msg"},$(this).attr("rel")]),$(".modal-footer",a.window).empty().show().append($("<button/>",{"class":"btn","data-dismiss":"modal","aria-hidden":!0,html:__("no",!1)})).append($("<button/>",{"class":"btn btn_primary","data-toggle":"modal","data-target":"#window",html:__("yes",!1)}).on("click",c)),a.window.modal("show")}else $.proxy(a.go,b)();return!1}return!0},$.xUpdater.execAction=function($this){var self=this,url=$this.attr("href"),selector=$this.attr("rev").replace(/|/,",");self.execBeforeRequest(selector),$.ajax({url:url,success:function(html,status,http){if($(self.settings.indicator).css({display:"none"}),eval("var Xnotifier = "+http.getResponseHeader("X-Notifier")+";"),$.xUpdater.updateDivs(html,$this),Xnotifier){var icon="success"!=Xnotifier.type?"icon-remove-sign":"icon-ok-sign";$(".modal-body",self.window).empty().createAppend(["i",{"class":icon+" icon-3x"},"","p",{},Xnotifier.message]),$(".modal-footer",self.window).empty().show().append($("<button/>",{"class":"btn btn_primary","data-dismiss":"modal","aria-hidden":!0,html:__("acept")})),self.window.modal("show")}else self.window.modal("hide")},beforeSend:function(a){var b,c=Array();$.each($this.attr("rev").split("|"),function(a,d){d.match(/.*:.*/)?(b=d.split(":"),c.push(b[0].replace("#",""))):c.push(d.replace("#",""))}),a.setRequestHeader("X-update",c.join(" "))}})},$.xUpdater.count=function(a){var b=0;return $(a).each(function(){b++}),b},$.xUpdater.updateDivs=function(a,b){var c=a;"string"==typeof a&&a.match(/__ajaxUpdater__/)&&(c=$.xUpdater.getContentDivs(a));var d,e=$.xUpdater,f=Array(),g=b?b.attr("rev").split("|"):$.xUpdater.div.split("|");$.each(g,function(a,b){"string"==typeof b&&b.match(/.*:.*/)?(d=b.split(":"),f[d[0]]=d[1]):(d=[b,"update"],f[b]="update")}),"string"==typeof c?("update"==d[1]?$(d[0]).html(c):$(d[0]).append(c),e.refresh($(d[0])),e.__callbacks(d[0])):$.each(c,function(a,b){"append"==f["#"+a]?$("#"+a).append(unescape(decodeURIComponent(b))):$("#"+a).html(unescape(decodeURIComponent(b))),e.refresh($("#"+a)),e.__callbacks("#"+a)})},$.xUpdater.__callbacks=function(a){this.execAfterRequest($(a)),this.settings.callbacks[a.replace("#","")]&&this.settings.callbacks[a.replace("#","")]($(a))},$.xUpdater.getContentDivs=function(html){return html.match(/__ajaxUpdater__/)?(eval(html.replace(/<[^>].*>|\/\/<.*?A\[|\/\/\]\]>|for\s\(n[^\}]+}/gi,"")),__ajaxUpdater__):!1},$.xUpdater.go=function(){var a=$.xUpdater;""!=$.History.getHash&&(a.div=this.attr("rev")),a.setHash("#"+id[1]+"="+this.attr("href"))},$.xUpdater.setHash=function(a,b){var c=a.match(/(.+)\=(.+)/);c&&b&&($.xUpdater.settings.callbacks[c[1]]=b),$.History.setHash(a)},$.xUpdater.getHash=function(){return $.History.getHash()},$.xUpdater.refresh=function(a){$($.xUpdater.selector,a).click($.xUpdater.click)},$.xUpdater.execAfterRequest=function(a,b){$.each($.xUpdater.afterRequest,function(c,d){"function"==typeof d&&d(a,b)})},$.xUpdater.execBeforeRequest=function(a,b){$.each($.xUpdater.beforeRequest,function(c,d){"function"==typeof d&&d(a,b)})},$.xUpdater.setCallback=function(a,b){a&&"afterRequest"==a?$.xUpdater.afterRequest.push(b):a&&"beforeRequest"==a?$.xUpdater.beforeRequest.push(b):$.xUpdater.settings.callbacks[a]=b},$.xUpdater.settings={selector:'a[rev^="#"]',indicator:"#Loading",callbacks:[]},$(document).ready(function(){$.xUpdater()});